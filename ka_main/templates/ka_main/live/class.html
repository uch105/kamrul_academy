{% extends 'ka_main/live/base.html' %}
{% load static %}

{% block title %}
{% endblock %}

{% block body %}


    <h1>Live Class</h1>
    <video id="studentVideo" autoplay controls></video>
    <script>
        const videoElement = document.getElementById('studentVideo');
        const ws = new WebSocket('ws://' + window.location.host + '/ws/live/');
        const mediaSource = new MediaSource();

        videoElement.src = URL.createObjectURL(mediaSource);

        mediaSource.addEventListener('sourceopen', function() {
            const sourceBuffer = mediaSource.addSourceBuffer('video/webm; codecs="vp8"');

            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                const videoBlob = new Blob([data.message], { type: 'video/webm' });
                videoBlob.arrayBuffer().then(buffer => {
                    sourceBuffer.appendBuffer(buffer);
                });
            };
        });
    </script>


{% endblock %}