{% extends 'ka_main/live/base.html' %}
{% load static %}

{% block title %}
{% endblock %}

{% block body %}


    <h1>Live Class</h1>
    <video id="videoElement" autoplay playsinline controls></video>
    <script>
        const videoElement = document.getElementById('videoElement');
        let mediaSource = new MediaSource();
        videoElement.src = URL.createObjectURL(mediaSource);

        let sourceBuffer;

        mediaSource.addEventListener('sourceopen', () => {
            sourceBuffer = mediaSource.addSourceBuffer('video/webm; codecs="vp9"');
        });

        let protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        let socket = new WebSocket(protocol + '//' + window.location.host + '/ws/stream/');

        socket.binaryType = 'arraybuffer';

        socket.onmessage = (event) => {
            if (sourceBuffer && !sourceBuffer.updating) {
                sourceBuffer.appendBuffer(new Uint8Array(event.data));
            }
        };

        socket.onopen = () => console.log('WebSocket connection opened');
        socket.onclose = () => console.log('WebSocket connection closed');
    </script>


{% endblock %}